<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>{% if pack %}Просмотр смайлопака {{ pack.name or pack.hid }}{% else %}Создание смайлопака{% endif %}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='generator.css') }}" />
</head>
<body>

<div class="top">
    <div class="header">
        <div class="actions-menu">
            Другие действия ▼
            <ul class="actions-list">
                <li id="action-storage-save">Сохранить в localStorage</li>
                <li id="action-storage-load">Загрузить из localStorage</li>
                <li id="action-import-userscript">Импортировать юзерскрипт</li>
                <li id="action-toggle-dark">Поменять фон</li>
            </ul>
        </div>
        <div class="header-right">
            {% if config['ISSUE_REPORT_LINK'] -%}
                <a href="{{ config['ISSUE_REPORT_LINK'] }}" target="_blank" class="report-link">Сообщить о проблеме</a>
            {%- endif %}
        </div>
        <div class="logo"><a href="{{ url_for('pages.index') }}" id="index_link">Смайлопак</a></div>
    </div>

    <div class="settings">
    Название: <input class="text" id="name" value="{{ pack.name if pack else '' }}" autocomplete="off" placeholder="Опционально" />
    {% if config['ALLOW_LIFETIME_SELECT'] -%}
    Удалить с сервера через:
    <select id="lifetime" autocomplete="off">
        <option{{ ' selected' if not pack or lifetime == 1800 else '' }} value="1800">Полчаса</option>
        <option{{ ' selected' if pack and lifetime == 3600 else '' }} value="3600">1 час</option>
        <option{{ ' selected' if pack and lifetime == 28800 else '' }} value="28800">8 часов</option>
        <option{{ ' selected' if pack and lifetime == 86400 else '' }} value="86400">1 день</option>
        <option{{ ' selected' if lifetime == 604800 else '' }} value="604800">1 неделя</option>
        {% if config['MAX_LIFETIME'] == 0 %}<option{{ ' selected' if lifetime == 0 or lifetime == None else '' }} value="0">Оставить навсегда</option>{% endif %}
    </select>
    {%- endif %}
    {% if pack %}
    <button class="button button-primary action-save">Сохранить новый смайлопак</button>
    <a href="{{ url_for('smilepacks.download_compat', smp_id=pack.hid) }}" target="_blank" id="smp-last-url">Скачать последнюю сохранённую версию</a>
    {% else %}
    <button class="button button-primary action-save">Сохранить и скачать смайлопак!</button>
    <a href="#" target="_blank" id="smp-last-url" style="display: none;">Скачать последнюю сохранённую версию</a>
    {% endif %}
    {% if pack_deletion_date %}
    <span id="smp-delete-container">(смайлопак будет удалён <span id="smp-delete-date">{{ pack_deletion_date }}</span>)</span>
    {% else %}
    <span id="smp-delete-container" style="display: none;">(смайлопак будет удалён <span id="smp-delete-date"></span>)</span>
    {% endif %}
    </div>
</div>

<div class="container">
<div class="container-left" id="collection">
    <div style="text-align: center"><img src="{{ url_for('static', filename='loading.gif') }}" alt="" /></div>
    <div class="additional" style="display: none;">
        <button class="button button action-move-all">Перенести всю категорию в смайлопак</button><br/>
    </div>
</div><div class="container-right" id="smilepack">
    <div class="additional" style="display: none">
        <button class="button button action-add-smile">Добавить свой смайлик</button>
    </div>
</div>
</div><!-- /container -->

<div id="dialog-background" class="dialog-background hidden"></div>

<div id="dialog-new-category" class="dialog hidden mode-add">
    <div class="dialog-title"><a class="dialog-close"></a> <span class="mode-add">Добавление категории</span><span class="mode-edit">Изменение категории</span></div>

    <form action="#">
        <label for="name">Название категории:</label><br/>
        <input name="name" class="text input-width-full" /><br/>

        <label for="icon">Иконка:</label><br/>
        <div class="icon-container">
        {%- for icon in icons %}
            <label>
                <input type="radio" name="icon" data-value-url="{{ icon.url }}" value="{{ icon.id }}"{{ ' checked' if loop.first else '' }} />
                <img src="{{ icon.url }}" alt="" class="dialog-icon" />
            </label>
        {%- endfor %}
        </div>

        <input type="hidden" name="category" value="" />

        <span class="mode-add"><input type="submit" class="button button-primary" value="Добавить" /></span>
        <span class="mode-edit"><input type="submit" class="button button-primary" value="Сохранить" /></span>
    </form>
</div>

<div id="dialog-new-smile" class="dialog hidden">
    <div class="dialog-title"><a class="dialog-close"></a> Добавление смайлика</div>

    <form action="#">
        {% if config.UPLOAD_METHOD != None -%}
        <div class="uploader-choice">
            <label><input type="radio" name="uploader" value="link" autocomplete="off" checked> По ссылке</label>
            <label><input type="radio" name="uploader" value="file" autocomplete="off"> С компьютера</label>
        </div>

        <div class="file-uploader" style="display: none">
            <input name="file" type="file" class="input-width-full" accept="image/jpeg,image/png,image/gif" /><br/>
        </div>
        {% endif -%}

        <div class="link-uploader">
            <label for="url">Ссылка:</label><br/>
            <input name="url" class="text input-width-full" /><br/>
        </div>

        Размер смайлика:
        <input name="w" type="number" style="width: 6em;" value="" placeholder="Длина" class="text" />
        x
        <input name="h" type="number" style="width: 6em;" value="" placeholder="Ширина" class="text" />
        <label><input type="checkbox" name="save_aspect" checked />Сохранить соотн. сторон</label>
        <br/>
        <div class="smile-add-notice">Реальные размеры картинки изменены не будут; при необходимости сожмите её самостоятельно в любом графическом редакторе.</div>

        <img class="new-smile-preview" src="data:image/gif;base64,R0lGODdhAQABAIABAP///+dubiwAAAAAAQABAAACAkQBADs=" width="0" height="0" /><br/>

        <input type="hidden" name="level" value="0" />
        <input type="hidden" name="category" value="0" />

        <input type="submit" class="button button-primary" value="Добавить" />
    </form>
</div>

<div id="dialog-import-userscript" class="dialog hidden">
    <div class="dialog-title"><a class="dialog-close"></a> Импортирование юзерскрипта</div>

    <form action="#" method="POST" enctype="multipart/form-data">
        <label for="url">Выберите файл с юзерскриптом</label><br/>
        <input type="file" name="file" /><br/>

        <input type="submit" class="button button-primary" value="Импортировать" />
    </form>
</div>

<div id="dialog-save" class="dialog hidden">
    <div class="dialog-title">Сохранение смайлопака</div>
    <div class="processing">
        <span class="processing-begin">Создаём смайлик <span class="smile-current">%d</span> из <span class="smiles-count">%d</span>...</span>
        <span class="processing-end">Сохраняем...</span>
    </div>
    <div class="saved" style="display: none; text-align: center;">
        <div style="font-size: 1.25em">Смайлопак сохранён!</div>
        <div style="font-size: 1.45em; line-height: 3em">Его id: <span class="smp-id" style="font-weight: bold;"></span></div>

        Теперь вы можете:<br/>
        <ol style="text-align: left; line-height: 1.5em;">
        <li><a href="#" class="smp-url" target="_blank">Скачать юзерскрипт</a> и установить его в браузере, чтобы пользоваться смайлопаком на всех сайтах с поддержкой HTML или BBCode.</li>
        <li>Дать посмотреть кому-нибудь ваш смайлопак, поделившись ссылкой: <a href="#" class="smp-view-url" target="_blank">#</a></li>
        <!-- <li>Интегрировать его в сайт, поддерживающий смайлопак, без установки юзерскрипта с помощью указанного выше id. Но пока сайтов с поддержкой интеграции нет и неизвестно, появятся ли вообще, поэтому эта строчка закомментирована :)</li> -->
        <li>Закрыть это сообщение и продолжить редактирование, чтобы создать ещё один смайлопак (предыдущий сохранённый смайлопак останется).</li>
        </ol>

        <a href="#" class="dialog-close">Вернуться к редактированию</a>
    </div>
</div>

{% if config['USE_BUNDLER'] %}
<script type="text/javascript" src="{{ get_bundle_url('generator') }}"></script>
{% else %}
<script type="text/javascript" src="{{ url_for('static', filename='js/dragdrop.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/widgets.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dialogs.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/smp_ajax.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/generator.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/generator_dialogs.js') }}"></script>
{% endif %}

<script>
generator.collectionData = {{ collection_data|tojson|safe }};
{% if pack %}
generator.smilepackData = {{ pack.bl.as_json(with_smiles=True)|tojson|safe }};
{% endif -%}
</script>
</body>
</html>
