<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>{% if pack %}Просмотр смайлопака {{ pack.name or pack.encoded_id }}{% else %}Создание смайлопака{% endif %}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='generator.css') }}" />
</head>
<body>

<div class="top">
    <div class="header">
        <div class="logo"><a href="{{ url_for('pages.index') }}" id="index_link">Смайлопак</a></div>
    </div>

    <div class="settings">
    Название: <input class="text" id="name" value="{{ pack.name if pack else '' }}" autocomplete="off" placeholder="Опционально" />
    Удалить через:
    <select id="lifetime" autocomplete="off">
        <option{{ ' selected' if not pack or pack.lifetime == 1800 else '' }} value="1800">Полчаса</option>
        <option{{ ' selected' if pack and pack.lifetime == 3600 else '' }} value="3600">1 час</option>
        <option{{ ' selected' if pack and pack.lifetime == 28800 else '' }} value="28800">8 часов</option>
        <option{{ ' selected' if pack and pack.lifetime == 86400 else '' }} value="86400">1 день</option>
        <option{{ ' selected' if pack.lifetime == 604800 else '' }} value="604800">1 неделя</option>
        {#<!--<option{{ ' selected' if pack.lifetime == 0 or pack.lifetime == None else '' }} value="0">Оставить навсегда</option>-->#}
    </select>
    {% if pack %}
    <button class="button button-primary action-save">Сохранить новый смайлопак</button>
    <a href="{{ url_for('smilepacks.download_compat', smp_id=pack.encoded_id) }}" target="_blank" id="smp-last-url">Скачать последнюю сохранённую версию</a>
    {% else %}
    <button class="button button-primary action-save">Сохранить и скачать смайлопак!</button>
    <a href="#" target="_blank" id="smp-last-url" style="display: none;">Скачать последнюю сохранённую версию</a>
    {% endif %}
    {% if pack_deletion_date %}
    <span id="smp-delete-container">(смайлопак будет удалён <span id="smp-delete-date">{{ pack_deletion_date }}</span>)</span>
    {% else %}
    <span id="smp-delete-container" style="display: none;">(смайлопак будет удалён <span id="smp-delete-date"></span>)</span>
    {% endif %}
    </div>
</div>

<div class="container">
<div class="container-left" id="collection">
    <div class="additional">
        <button class="button button action-move-all">Перенести всю категорию в смайлопак</button><br/>
        <em style='color: #ccc; font-size: 0.75em;'>Не нашли нужного смайлика? Когда-нибудь их можно будет предложить.</em>
    </div>
</div><div class="container-right" id="smilepack">
    <div class="additional">
        <button class="button button action-add-smile">Добавить свой смайлик</button>
    </div>
</div>
</div><!-- /container -->

<div id="dialog-background" class="dialog-background hidden"></div>

<div id="dialog-new-category" class="dialog hidden">
    <div class="dialog-title"><a class="dialog-close"></a> Добавление категории</div>

    <form action="#">
        <label for="name">Название категории:</label><br/>
        <input name="name" class="text input-width-full" /><br/>

        <label for="icon">Иконка:</label><br/>
        <div class="icon-container">
        {%- for icon in icons %}
            <label>
                <input type="radio" name="icon" data-value-url="{{ icon.url }}" value="{{ icon.id }}"{{ ' checked' if loop.first else '' }} />
                <img src="{{ icon.url }}" alt="" class="dialog-icon" />
            </label>
        {%- endfor %}
        </div>

        <input type="hidden" name="level" value="0" />
        <input type="hidden" name="parent" value="0" />

        <input type="submit" class="button button-primary" value="Создать" />
    </form>
</div>

<div id="dialog-new-smile" class="dialog hidden">
    <div class="dialog-title"><a class="dialog-close"></a> Добавление смайлика</div>

    <form action="#">
        <label for="url">Ссылка:</label><br/>
        <input name="url" class="text input-width-full" /><br/>

        Размер:
        <input name="w" type="number" style="width: 6em;" value="" placeholder="Длина" class="text" />
        x
        <input name="h" type="number" style="width: 6em;" value="" placeholder="Ширина" class="text" />

        <br/>
        <img class="new-smile-preview" src="data:image/gif;base64,R0lGODdhAQABAIABAP///+dubiwAAAAAAQABAAACAkQBADs=" width="0" height="0" /><br/>

        <input type="hidden" name="level" value="0" />
        <input type="hidden" name="category" value="0" />

        <input type="submit" class="button button-primary" value="Добавить" />
    </form>
</div>

<div id="dialog-save" class="dialog hidden">
    <div class="dialog-title">Сохранение смайлопака</div>
    <div class="processing">Сохраняем...</div>
    <div class="saved" style="display: none; text-align: center;">
        <div style="font-size: 1.25em">Смайлопак сохранён!</div>
        <div style="font-size: 1.45em; line-height: 3em">Его id: <span class="smp-id" style="font-weight: bold;"></span></div>

        Теперь вы можете:<br/>
        <ol style="text-align: left; line-height: 1.5em;">
        <li><a href="#" class="smp-url" target="_blank">Скачать юзерскрипт</a> и установить его в браузере, чтобы пользоваться смайлопаком на всех сайтах с поддержкой HTML или BBCode.</li>
        <li>Дать посмотреть кому-нибудь ваш смайлопак, поделившись ссылкой: <a href="#" class="smp-view-url" target="_blank">#</a></li>
        <!-- <li>Интегрировать его в сайт, поддерживающий смайлопак, без установки юзерскрипта с помощью указанного выше id. Но пока сайтов с поддержкой интеграции нет и неизвестно, появятся ли вообще, поэтому эта строчка закомментирована :)</li> -->
        <li>Закрыть это сообщение и продолжить редактирование, чтобы создать ещё один смайлопак (предыдущий сохранённый смайлопак останется).</li>
        </ol>

        <a href="#" class="dialog-close">Вернуться к редактированию</a>
    </div>
</div>

<script type="text/javascript" src="{{ url_for('static', filename='smp_ajax.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='dragdrop.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='widgets.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='generator.js') }}"></script>

<script>
generator.collectionData = {{ collection_data|tojson|safe }};
{% if pack %}
generator.smilepackData = {{ pack.bl.as_json()|tojson|safe }};
{% endif -%}
</script>
</body>
</html>
